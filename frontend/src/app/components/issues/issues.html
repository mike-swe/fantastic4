<div class="issues-page">
  <div class="issues-header">
    <div class="header-content">
      <div class="header-title-section">
        <h1 class="issues-title">Issues</h1>
        <p class="issues-subtitle">Track and manage issues across all projects</p>
      </div>
      @if (userRole === Role.TESTER) {
        <button class="btn-new-issue" (click)="createNewIssue()">
          <span class="btn-icon">+</span> New Issue
        </button>
      }
    </div>
  </div>

  <div class="search-filter-bar">
    <div class="search-container">
      <input
        type="text"
        class="search-input"
        placeholder="Search issues by title or ID..."
        [(ngModel)]="searchQuery"
        (input)="onSearchChange()"
      />
    </div>
    <div class="filter-container">
      <select
        class="filter-dropdown"
        [(ngModel)]="selectedStatus"
        (change)="onStatusChange()"
      >
        @for (status of statusOptions; track status) {
          <option [value]="status">
            {{ status === 'ALL' ? 'All Status' : status.replace('_', ' ') }}
          </option>
        }
      </select>
      <select
        class="filter-dropdown"
        [(ngModel)]="selectedSeverity"
        (change)="onSeverityChange()"
      >
        @for (severity of severityOptions; track severity) {
          <option [value]="severity">
            {{ severity === 'ALL' ? 'All Severity' : severity }}
          </option>
        }
      </select>
    </div>
  </div>

  <div class="issues-content">
    <div class="issues-grid">
      @for (issue of filteredIssues; track issue.id) {
        <div class="issue-card" (click)="openIssueDetail(issue)">
          <div class="issue-header">
            <span class="issue-id">{{ formatIssueId(issue.id) }}</span>
            <div class="issue-tags">
              <span 
                class="tag" 
                [style.background-color]="getStatusColor(issue.status)"
                [style.color]="'#ffffff'"
              >
                {{ issue.status.replace('_', ' ') }}
              </span>
              <span 
                class="tag" 
                [style.background-color]="getSeverityColor(issue.severity)"
                [style.color]="'#ffffff'"
              >
                {{ issue.severity }}
              </span>
              <span 
                class="tag" 
                [style.background-color]="getPriorityColor(issue.priority)"
                [style.color]="'#ffffff'"
              >
                {{ issue.priority }}
              </span>
            </div>
          </div>
          
          <h3 class="issue-title">{{ issue.title }}</h3>
          <p class="issue-description">{{ truncateDescription(issue.description) }}</p>
          
          <div class="issue-details">
            <span class="issue-project">{{ issue.project.name || 'Unknown Project' }}</span>
            <span class="issue-updated">
              Updated {{ formatDate(issue.updatedAt) }}
            </span>
          </div>
          
          <div class="issue-footer">
            <div class="issue-assignment">
              @if (issue.createdBy) {
                <div class="assignment-info">
                  <span class="assignment-label">Created by</span>
                  <div class="user-avatar" [style.background-color]="'#3b82f6'">
                    {{ getUserInitials(issue.createdBy) }}
                  </div>
                  <span class="user-name">{{ issue.createdBy.username }}</span>
                </div>
              }
            </div>
          </div>
        </div>
      } @empty {
        <div class="empty-state">
          <p>No issues found. @if (userRole === Role.TESTER) { Create your first issue to get started! } @else { No issues match your filters. }</p>
        </div>
      }
    </div>
  </div>

  @if (showModal) {
    <app-new-issue-modal
      (close)="onModalClose()"
      (issueCreated)="onIssueCreated($event)"
    ></app-new-issue-modal>
  }

  @if (showDetailModal && selectedIssue) {
    <app-issue-detail-modal
      [issue]="selectedIssue"
      (close)="onDetailModalClose()"
    ></app-issue-detail-modal>
  }
</div>

